<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback" defer></script>

<div class="container mt-5">
  <div
    id="turnstile-container"
  ></div>

  <button id="check-challenge" type="button" class="btn btn-primary mt-5">check challenge</button>

  <div id="load-time"></div>
</div>

<script>
  const t0 = performance.now()
  let t1 = 0

  window.onloadTurnstileCallback = function () {
    turnstile.render('#turnstile-container', {
        sitekey: '{{sitekey}}',
        callback: function(token) {
          t1 = performance.now()
          window.turnstileToken = token

          const loadTime = document.getElementById("load-time")
          loadTime.innerText = t1 - t0
        },
    });
};

const checkCallengeButton = document.getElementById("check-challenge")

checkCallengeButton.addEventListener("click", async () => {
  const result = await fetch('/check-challenge', {
    method: "POST",
    body: JSON.stringify(
      {
        token: window.turnstile_token
      }
    )
  })

  const json = await result.json()

  console.log(json)
})
</script>
